openapi: 3.1.0
info:
  title: Converto Business OS API
  version: 1.0.0
  description: DocFlow backend API for document processing, admin management, and business operations
servers:
  - url: http://localhost:8000
    description: Local development
  - url: https://api.docflow.fi
    description: Production
paths:
  /api/admin/activities:
    get:
      operationId: getAdminActivities
      summary: Get admin activities
      tags:
        - Admin
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: tenant_id
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityResponse'
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
      security:
        - BearerAuth: []
    post:
      operationId: createAdminActivity
      summary: Create admin activity
      tags:
        - Admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                details:
                  type: object
                tenant_id:
                  type: string
      responses:
        '201':
          description: Activity created
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
      security:
        - BearerAuth: []
  /api/admin/feed:
    get:
      operationId: adminWebSocketFeed
      summary: Admin WebSocket feed
      tags:
        - Admin
      description: WebSocket endpoint for real-time activity feed
      responses:
        '101':
          description: Switching protocols to WebSocket
      security:
        - BearerAuth: []
  /api/admin/stats:
    get:
      operationId: getAdminStats
      summary: Get admin dashboard statistics
      tags:
        - Admin
      responses:
        '200':
          description: Successful response
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
      security:
        - BearerAuth: []
  /api/admin/health:
    get:
      operationId: adminHealth
      summary: Admin module health check
      tags:
        - Admin
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  timestamp:
                    type: number
                  active_connections:
                    type: integer
                  bus_config:
                    type: object
  /metrics:
    get:
      operationId: getMetrics
      summary: Prometheus metrics endpoint
      tags:
        - Observability
      responses:
        '200':
          description: Prometheus metrics in text format
          content:
            text/plain:
              schema:
                type: string
  /api/receipts:
    get:
      operationId: listReceipts
      summary: List receipts
      tags:
        - Receipts
      responses:
        '200':
          description: List of receipts
      security:
        - BearerAuth: []
    post:
      operationId: createReceipt
      summary: Create receipt
      tags:
        - Receipts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201':
          description: Receipt created
      security:
        - BearerAuth: []
  /api/receipts/scan:
    post:
      operationId: scanReceipt
      summary: Scan receipt image
      tags:
        - Receipts
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Scan result
  /api/ocr/power:
    post:
      operationId: ocrPower
      summary: OCR processing endpoint
      tags:
        - OCR
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: OCR result
      security:
        - BearerAuth: []
  /api/stripe/webhook:
    post:
      operationId: stripeWebhook
      summary: Stripe webhook handler
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook processed
  /api/email/send:
    post:
      operationId: sendEmail
      summary: Send email
      tags:
        - Email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                to:
                  type: string
                subject:
                  type: string
                html:
                  type: string
      responses:
        '200':
          description: Email sent
      security:
        - BearerAuth: []
components:
  schemas:
    ActivityResponse:
      type: object
      properties:
        activities:
          type: array
          items:
            type: object
        total:
          type: integer
        page:
          type: integer
        per_page:
          type: integer
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

